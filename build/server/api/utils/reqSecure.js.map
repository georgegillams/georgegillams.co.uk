{"version":3,"sources":["../../../../server/api/utils/reqSecure.js"],"names":["standardAttributes","attribute","pattern","ID_REGEX","PASSWORD_REGEX","INT_REGEX","generateNewComponent","component","req","allAllowedAttributes","undefined","newComponent","i","length","name","toString","match","reqSecure","allowedAttributes","body","query","headers","cookies"],"mappings":";;;;;;;;;;;AAAA;;AAEA,IAAMA,kBAAkB,GAAG,CACzB;AAAEC,EAAAA,SAAS,EAAE,SAAb;AAAwBC,EAAAA,OAAO,EAAE;AAAjC,CADyB,EAEzB;AAAED,EAAAA,SAAS,EAAE,IAAb;AAAmBC,EAAAA,OAAO,EAAEC;AAA5B,CAFyB,EAGzB;AAAEF,EAAAA,SAAS,EAAE,aAAb;AAA4BC,EAAAA,OAAO,EAAEC;AAArC,CAHyB,EAIzB;AAAEF,EAAAA,SAAS,EAAE,QAAb;AAAuBC,EAAAA,OAAO,EAAEE;AAAhC,CAJyB,EAKzB;AAAEH,EAAAA,SAAS,EAAE,WAAb;AAA0BC,EAAAA,OAAO,EAAEG;AAAnC,CALyB,EAMzB;AAAEJ,EAAAA,SAAS,EAAE,SAAb;AAAwBC,EAAAA,OAAO,EAAEC;AAAjC,CANyB,CAA3B;;AASA,SAASG,oBAAT,CAA8BC,SAA9B,EAAyCC,GAAzC,EAA8CC,oBAA9C,EAAoE;AAClE,MAAI,CAACD,GAAG,CAACD,SAAD,CAAR,EAAqB;AACnB,WAAOG,SAAP;AACD;;AACD,MAAMC,YAAY,GAAG,EAArB;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,oBAAoB,CAACI,MAAzC,EAAiDD,CAAC,IAAI,CAAtD,EAAyD;AACvD,QAAME,IAAI,GAAGL,oBAAoB,CAACG,CAAD,CAApB,CAAwBX,SAArC;AACA,QAAMC,OAAO,GAAGO,oBAAoB,CAACG,CAAD,CAApB,CAAwBV,OAAxC;;AACA,QAAIM,GAAG,CAACD,SAAD,CAAH,CAAeO,IAAf,CAAJ,EAA0B;AACxB,UAAIZ,OAAO,KAAK,MAAhB,EAAwB;AACtBS,QAAAA,YAAY,CAACG,IAAD,CAAZ,GAAqB,CAAC,CAACN,GAAG,CAACD,SAAD,CAAH,CAAeO,IAAf,CAAvB;AACD,OAFD,MAEO;AACL;AACA,YAAIZ,OAAO,IAAIM,GAAG,CAACD,SAAD,CAAH,CAAeO,IAAf,EAAqBC,QAArB,GAAgCC,KAAhC,CAAsCd,OAAtC,CAAf,EAA+D;AAC7DS,UAAAA,YAAY,CAACG,IAAD,CAAZ,GAAqBN,GAAG,CAACD,SAAD,CAAH,CAAeO,IAAf,CAArB;AACD;AACF;AACF;AACF;;AACD,SAAOH,YAAP;AACD;;AAEc,SAASM,SAAT,CAAmBT,GAAnB,EAAwBU,iBAAxB,EAA2C;AACxD,MAAMT,oBAAoB,iDAAOS,iBAAP,GAA6BlB,kBAA7B,CAA1B;AAEAQ,EAAAA,GAAG,CAACW,IAAJ,GAAWb,oBAAoB,CAAC,MAAD,EAASE,GAAT,EAAcC,oBAAd,CAA/B;AACAD,EAAAA,GAAG,CAACY,KAAJ,GAAYd,oBAAoB,CAAC,OAAD,EAAUE,GAAV,EAAeC,oBAAf,CAAhC;AACAD,EAAAA,GAAG,CAACa,OAAJ,GAAcf,oBAAoB,CAAC,SAAD,EAAYE,GAAZ,EAAiBC,oBAAjB,CAAlC;AACAD,EAAAA,GAAG,CAACc,OAAJ,GAAchB,oBAAoB,CAAC,SAAD,EAAYE,GAAZ,EAAiBC,oBAAjB,CAAlC;AACA,SAAOD,GAAP;AACD","sourcesContent":["import { INT_REGEX, ID_REGEX, PASSWORD_REGEX } from 'helpers/constants';\n\nconst standardAttributes = [\n  { attribute: 'deleted', pattern: 'BOOL' },\n  { attribute: 'id', pattern: ID_REGEX },\n  { attribute: 'requestedId', pattern: ID_REGEX },\n  { attribute: 'apikey', pattern: PASSWORD_REGEX },\n  { attribute: 'timestamp', pattern: INT_REGEX },\n  { attribute: 'session', pattern: ID_REGEX },\n];\n\nfunction generateNewComponent(component, req, allAllowedAttributes) {\n  if (!req[component]) {\n    return undefined;\n  }\n  const newComponent = {};\n  for (let i = 0; i < allAllowedAttributes.length; i += 1) {\n    const name = allAllowedAttributes[i].attribute;\n    const pattern = allAllowedAttributes[i].pattern;\n    if (req[component][name]) {\n      if (pattern === 'BOOL') {\n        newComponent[name] = !!req[component][name];\n      } else {\n        // pattern is a regex:\n        if (pattern && req[component][name].toString().match(pattern)) {\n          newComponent[name] = req[component][name];\n        }\n      }\n    }\n  }\n  return newComponent;\n}\n\nexport default function reqSecure(req, allowedAttributes) {\n  const allAllowedAttributes = [...allowedAttributes, ...standardAttributes];\n\n  req.body = generateNewComponent('body', req, allAllowedAttributes);\n  req.query = generateNewComponent('query', req, allAllowedAttributes);\n  req.headers = generateNewComponent('headers', req, allAllowedAttributes);\n  req.cookies = generateNewComponent('cookies', req, allAllowedAttributes);\n  return req;\n}\n"],"file":"reqSecure.js"}