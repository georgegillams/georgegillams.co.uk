{"version":3,"sources":["../../../../../server/api/actions/analytics/create.js"],"names":["create","req","reqSecured","analyticsAllowedAttributes","Promise","resolve","reject","then","user","ipAddress","connection","remoteAddress","headers","redisKey","r","err"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;;;;;AAEe,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AAClC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,sCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,oCAAeJ,UAAf,EACGK,IADH,CACQ,UAAAC,IAAI,EAAI;AACZ,UAAIC,SAAS,GAAGR,GAAG,CAACS,UAAJ,CAAeC,aAA/B;;AACA,UAAIV,GAAG,CAACW,OAAJ,CAAY,iBAAZ,CAAJ,EAAoC;AAClCH,QAAAA,SAAS,GAAGR,GAAG,CAACW,OAAJ,CAAY,iBAAZ,CAAZ;AACD;;AACD,8BACE;AAAEC,QAAAA,QAAQ,EAAE,WAAZ;AAAyBL,QAAAA,IAAI,EAAJA;AAAzB,OADF,oBAEON,UAFP;AAEmBO,QAAAA,SAAS,EAATA;AAFnB,UAIGF,IAJH,CAIQ,UAAAO,CAAC;AAAA,eAAIT,OAAO,CAAC,EAAD,CAAX;AAAA,OAJT,WAKS,UAAAU,GAAG;AAAA,eAAIT,MAAM,CAACS,GAAD,CAAV;AAAA,OALZ;AAMD,KAZH,WAaS,UAAAA,GAAG;AAAA,aAAIT,MAAM,CAACS,GAAD,CAAV;AAAA,KAbZ;AAcD,GAfM,CAAP;AAgBD","sourcesContent":["import { datumCreate } from '../datum';\n\nimport analyticsAllowedAttributes from './analyticsAllowedAttributes';\n\nimport authentication from 'utils/authentication';\nimport reqSecure from 'utils/reqSecure';\nimport { UNAUTHORISED_READ } from 'helpers/constants';\n\nexport default function create(req) {\n  const reqSecured = reqSecure(req, analyticsAllowedAttributes);\n  return new Promise((resolve, reject) => {\n    authentication(reqSecured)\n      .then(user => {\n        let ipAddress = req.connection.remoteAddress;\n        if (req.headers['x-forwarded-for']) {\n          ipAddress = req.headers['x-forwarded-for'];\n        }\n        datumCreate(\n          { redisKey: 'analytics', user },\n          { ...reqSecured, ipAddress },\n        )\n          .then(r => resolve({}))\n          .catch(err => reject(err));\n      })\n      .catch(err => reject(err));\n  });\n}\n"],"file":"create.js"}