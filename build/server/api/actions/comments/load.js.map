{"version":3,"sources":["../../../../../server/api/actions/comments/load.js"],"names":["load","req","reqSecured","commentsAllowedAttributes","Promise","resolve","reject","then","user","redisKey","includeOwnerUname","includeDeleted","admin","filter","query","pageId","comment","err"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AAEe,SAASA,IAAT,CAAcC,GAAd,EAAmB;AAChC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,qCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,oCAAeJ,UAAf,EAA2BK,IAA3B,CACE,UAAAC,IAAI,EAAI;AACNH,MAAAA,OAAO,CACL,sBAAU;AACRI,QAAAA,QAAQ,EAAE,UADF;AAERC,QAAAA,iBAAiB,EAAE,IAFX;AAGRC,QAAAA,cAAc,EAAEH,IAAI,IAAIA,IAAI,CAACI,KAHrB;AAIRC,QAAAA,MAAM,EAAEX,UAAU,CAACY,KAAX,CAAiBC,MAAjB,GACJ,UAAAC,OAAO;AAAA,iBAAIA,OAAO,CAACD,MAAR,KAAmBb,UAAU,CAACY,KAAX,CAAiBC,MAAxC;AAAA,SADH,GAEJ;AANI,OAAV,CADK,CAAP;AAUD,KAZH,EAaE,UAAAE,GAAG;AAAA,aAAIX,MAAM,CAACW,GAAD,CAAV;AAAA,KAbL;AAeD,GAhBM,CAAP;AAiBD","sourcesContent":["import { datumLoad } from '../datum';\n\nimport commentsAllowedAttributes from './commentsAllowedAttributes';\n\nimport authentication from 'utils/authentication';\nimport reqSecure from 'utils/reqSecure';\n\nexport default function load(req) {\n  const reqSecured = reqSecure(req, commentsAllowedAttributes);\n  return new Promise((resolve, reject) => {\n    authentication(reqSecured).then(\n      user => {\n        resolve(\n          datumLoad({\n            redisKey: 'comments',\n            includeOwnerUname: true,\n            includeDeleted: user && user.admin,\n            filter: reqSecured.query.pageId\n              ? comment => comment.pageId === reqSecured.query.pageId\n              : null,\n          }),\n        );\n      },\n      err => reject(err),\n    );\n  });\n}\n"],"file":"load.js"}