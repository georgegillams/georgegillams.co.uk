{"version":3,"sources":["../../../../../server/api/actions/data-management/backup.js"],"names":["dataFilePath","load","req","Promise","resolve","reject","then","user","admin","data","dataAnnotated","projectName","PROJECT_NAME","timestamp","Date","now","res","fs","writeFileSync","JSON","stringify","download","UNAUTHORISED_READ","err"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AAEA,IAAMA,YAAY,GAAG,iCAArB;;AAEe,SAASC,IAAT,CAAcC,GAAd,EAAmB;AAChC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,oCAAeH,GAAf,EAAoBI,IAApB,CACE,UAAAC,IAAI,EAAI;AACN,UAAIA,IAAI,IAAIA,IAAI,CAACC,KAAjB,EAAwB;AACtB,uCAAcF,IAAd,CAAmB,UAAAG,IAAI,EAAI;AACzB,cAAMC,aAAa,GAAG;AACpBC,YAAAA,WAAW,EAAEC,uBADO;AAEpBC,YAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAFS;AAGpBN,YAAAA,IAAI,EAAEA;AAHc,WAAtB;AAKAL,UAAAA,OAAO,CAAC,UAAAY,GAAG,EAAI;AACbC,2BAAGC,aAAH,CAAiBlB,YAAjB,EAA+BmB,IAAI,CAACC,SAAL,CAAeV,aAAf,CAA/B;;AACAM,YAAAA,GAAG,CAACK,QAAJ,CAAarB,YAAb;AACD,WAHM,CAAP;AAID,SAVD;AAWD,OAZD,MAYO;AACLK,QAAAA,MAAM,CAACiB,4BAAD,CAAN;AACD;AACF,KAjBH,EAkBE,UAAAC,GAAG;AAAA,aAAIlB,MAAM,CAACkB,GAAD,CAAV;AAAA,KAlBL;AAoBD,GArBM,CAAP;AAsBD","sourcesContent":["import loadAllData from './loadAllData';\nimport fs from 'fs';\n\nimport authentication from 'utils/authentication';\nimport { UNAUTHORISED_READ, PROJECT_NAME } from 'helpers/constants';\nimport reqSecure from 'utils/reqSecure';\n\nconst dataFilePath = 'server/server_content/data.json';\n\nexport default function load(req) {\n  return new Promise((resolve, reject) => {\n    authentication(req).then(\n      user => {\n        if (user && user.admin) {\n          loadAllData().then(data => {\n            const dataAnnotated = {\n              projectName: PROJECT_NAME,\n              timestamp: Date.now(),\n              data: data,\n            };\n            resolve(res => {\n              fs.writeFileSync(dataFilePath, JSON.stringify(dataAnnotated));\n              res.download(dataFilePath);\n            });\n          });\n        } else {\n          reject(UNAUTHORISED_READ);\n        }\n      },\n      err => reject(err),\n    );\n  });\n}\n"],"file":"backup.js"}