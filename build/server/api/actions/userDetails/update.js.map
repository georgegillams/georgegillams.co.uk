{"version":3,"sources":["../../../../../server/api/actions/userDetails/update.js"],"names":["update","req","reqSecured","userDetailsAllowedAttributes","Promise","resolve","reject","then","user","body","id","userOwnsResourceResult","admin","redisKey","UNAUTHORISED_WRITE","err"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;AACA;;AAEe,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AAClC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,wCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,oCAAeJ,UAAf,EAA2BK,IAA3B,CACE,UAAAC,IAAI,EAAI;AACN,8CAAiB,aAAjB,EAAgCN,UAAU,CAACO,IAAX,CAAgBC,EAAhD,EAAoDF,IAApD,EAA0DD,IAA1D,CACE,UAAAI,sBAAsB,EAAI;AACxB;AACA,YAAIH,IAAI,KAAKA,IAAI,CAACI,KAAL,IAAcD,sBAAnB,CAAR,EAAoD;AAClDN,UAAAA,OAAO,CAAC,wBAAY;AAAEQ,YAAAA,QAAQ,EAAE;AAAZ,WAAZ,EAAyCX,UAAzC,CAAD,CAAP;AACD,SAFD,MAEO;AACLG,UAAAA,OAAO,CAACS,6BAAD,CAAP;AACD;AACF,OARH;AAUD,KAZH,EAaE,UAAAC,GAAG;AAAA,aAAIT,MAAM,CAACS,GAAD,CAAV;AAAA,KAbL;AAeD,GAhBM,CAAP;AAiBD","sourcesContent":["import { datumUpdate } from '../datum';\n\nimport userDetailsAllowedAttributes from './userDetailsAllowedAttributes';\n\nimport authentication from 'utils/authentication';\nimport { userOwnsResource } from 'utils/userOwnsResource';\nimport { UNAUTHORISED_WRITE } from 'helpers/constants';\nimport reqSecure from 'utils/reqSecure';\n\nexport default function update(req) {\n  const reqSecured = reqSecure(req, userDetailsAllowedAttributes);\n  return new Promise((resolve, reject) => {\n    authentication(reqSecured).then(\n      user => {\n        userOwnsResource('userDetails', reqSecured.body.id, user).then(\n          userOwnsResourceResult => {\n            // Users should be able to update userDetails that they own\n            if (user && (user.admin || userOwnsResourceResult)) {\n              resolve(datumUpdate({ redisKey: 'userDetails' }, reqSecured));\n            } else {\n              resolve(UNAUTHORISED_WRITE);\n            }\n          },\n        );\n      },\n      err => reject(err),\n    );\n  });\n}\n"],"file":"update.js"}