{"version":3,"sources":["../../../../../server/api/actions/payments/create.js"],"names":["create","req","reqSecured","paymentsAllowedAttributes","Promise","resolve","reject","then","user","body","amount","error","errorMessage","redisKey","err"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AAEe,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AAClC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,qCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,oCAAeJ,UAAf,EAA2BK,IAA3B,CACE,UAAAC,IAAI,EAAI;AACN,UAAIN,UAAU,CAACO,IAAX,CAAgBC,MAAhB,GAAyB,EAA7B,EAAiC;AAC/BJ,QAAAA,MAAM,CAAC;AACLK,UAAAA,KAAK,EAAE,eADF;AAELC,UAAAA,YAAY,EAAE;AAFT,SAAD,CAAN;AAIA;AACD;;AACD,UAAIV,UAAU,CAACO,IAAX,CAAgBC,MAAhB,GAAyB,OAA7B,EAAsC;AACpCJ,QAAAA,MAAM,CAAC;AACLK,UAAAA,KAAK,EAAE,eADF;AAELC,UAAAA,YAAY,EAAE;AAFT,SAAD,CAAN;AAIA;AACD;;AACDP,MAAAA,OAAO,CAAC,wBAAY;AAAEQ,QAAAA,QAAQ,EAAE,UAAZ;AAAwBL,QAAAA,IAAI,EAAJA;AAAxB,OAAZ,EAA4CN,UAA5C,CAAD,CAAP;AACD,KAjBH,EAkBE,UAAAY,GAAG;AAAA,aAAIR,MAAM,CAACQ,GAAD,CAAV;AAAA,KAlBL;AAoBD,GArBM,CAAP;AAsBD","sourcesContent":["import { datumCreate } from '../datum';\n\nimport authentication from 'utils/authentication';\nimport { UNAUTHORISED_WRITE } from 'helpers/constants';\nimport reqSecure from 'utils/reqSecure';\nimport paymentsAllowedAttributes from './paymentsAllowedAttributes';\n\nexport default function create(req) {\n  const reqSecured = reqSecure(req, paymentsAllowedAttributes);\n  return new Promise((resolve, reject) => {\n    authentication(reqSecured).then(\n      user => {\n        if (reqSecured.body.amount < 30) {\n          reject({\n            error: 'invalid-input',\n            errorMessage: 'Payments under 30p are not possible.',\n          });\n          return;\n        }\n        if (reqSecured.body.amount > 1000000) {\n          reject({\n            error: 'invalid-input',\n            errorMessage: 'Payments over Â£10,000 are not possible.',\n          });\n          return;\n        }\n        resolve(datumCreate({ redisKey: 'payments', user }, reqSecured));\n      },\n      err => reject(err),\n    );\n  });\n}\n"],"file":"create.js"}