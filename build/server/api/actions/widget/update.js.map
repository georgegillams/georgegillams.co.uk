{"version":3,"sources":["../../../../../server/api/actions/widget/update.js"],"names":["update","req","Promise","resolve","reject","setTimeout","Math","random","then","data","widgets","widget","body","color","id","session","err"],"mappings":";;;;;;;;;AAAA;;AAEe,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AAClC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC;AACAC,IAAAA,UAAU,CAAC,YAAM;AACf,UAAIC,IAAI,CAACC,MAAL,KAAgB,GAApB,EAAyB;AACvBH,QAAAA,MAAM,CAAC,sDAAD,CAAN;AACD,OAFD,MAEO;AACL,8BAAKH,GAAL,EAAUO,IAAV,CACE,UAAAC,IAAI,EAAI;AACN,cAAMC,OAAO,GAAGD,IAAhB;AACA,cAAME,MAAM,GAAGV,GAAG,CAACW,IAAnB;;AACA,cAAID,MAAM,CAACE,KAAP,KAAiB,OAArB,EAA8B;AAC5BT,YAAAA,MAAM,CAAC;AACLS,cAAAA,KAAK,EAAE,gCADF,CACoC;;AADpC,aAAD,CAAN;AAGD;;AACD,cAAIF,MAAM,CAACG,EAAX,EAAe;AACbJ,YAAAA,OAAO,CAACC,MAAM,CAACG,EAAP,GAAY,CAAb,CAAP,GAAyBH,MAAzB,CADa,CACoB;;AACjCV,YAAAA,GAAG,CAACc,OAAJ,CAAYL,OAAZ,GAAsBA,OAAtB;AACD;;AACDP,UAAAA,OAAO,CAACQ,MAAD,CAAP;AACD,SAdH,EAeE,UAAAK,GAAG,EAAI;AACLZ,UAAAA,MAAM,CAACY,GAAD,CAAN;AACD,SAjBH;AAmBD;AACF,KAxBS,EAwBP,IAxBO,CAAV,CAFsC,CA0B5B;AACX,GA3BM,CAAP;AA4BD","sourcesContent":["import load from './load';\n\nexport default function update(req) {\n  return new Promise((resolve, reject) => {\n    // write to database\n    setTimeout(() => {\n      if (Math.random() < 0.2) {\n        reject('Oh no! Widget save fails 20% of the time. Try again.');\n      } else {\n        load(req).then(\n          data => {\n            const widgets = data;\n            const widget = req.body;\n            if (widget.color === 'Green') {\n              reject({\n                color: 'We do not accept green widgets', // example server-side validation error\n              });\n            }\n            if (widget.id) {\n              widgets[widget.id - 1] = widget; // id is 1-based. please don't code like this in production! :-)\n              req.session.widgets = widgets;\n            }\n            resolve(widget);\n          },\n          err => {\n            reject(err);\n          },\n        );\n      }\n    }, 1500); // simulate async db write\n  });\n}\n"],"file":"update.js"}