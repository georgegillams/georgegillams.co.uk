{"version":3,"sources":["../../../../server/api/actions/logoutall.js"],"names":["logoutall","req","reqSecured","usersAllowedAttributes","Promise","resolve","then","user","redisKey","sessionData","it","length","session","userId","id","userAuthenticatedTimestamp","body"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;AAEe,SAASA,SAAT,CAAmBC,GAAnB,EAAwB;AACrC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,kCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5B,oCAAeH,UAAf,EAA2BI,IAA3B,CAAgC,UAAAC,IAAI,EAAI;AACtC,UAAIA,IAAJ,EAAU;AACR,8BAAU;AAAEC,UAAAA,QAAQ,EAAE;AAAZ,SAAV,EAAoCF,IAApC,CAAyC,UAAAG,WAAW,EAAI;AACtD,eAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGD,WAAW,CAACE,MAAlC,EAA0CD,EAAE,IAAI,CAAhD,EAAmD;AACjD,gBAAME,OAAO,GAAGH,WAAW,CAACC,EAAD,CAA3B;;AACA,gBAAIE,OAAO,CAACC,MAAR,KAAmBN,IAAI,CAACO,EAA5B,EAAgC;AAC9BF,cAAAA,OAAO,CAACC,MAAR,GAAiB,IAAjB;AACAD,cAAAA,OAAO,CAACG,0BAAR,GAAqC,IAArC;AACAV,cAAAA,OAAO,CAAC,wBAAY;AAAEG,gBAAAA,QAAQ,EAAE;AAAZ,eAAZ,EAAsC;AAAEQ,gBAAAA,IAAI,EAAEJ;AAAR,eAAtC,CAAD,CAAP;AACA;AACD;AACF;AACF,SAVD;AAWD;AACF,KAdD;AAeD,GAhBM,CAAP;AAiBD","sourcesContent":["import { datumLoad, datumUpdate } from '../actions/datum';\n\nimport usersAllowedAttributes from './users/usersAllowedAttributes';\n\nimport authentication from 'utils/authentication';\nimport setContentLastUpdatedTimestamp from 'utils/setContentLastUpdatedTimestamp';\nimport reqSecure from 'utils/reqSecure';\n\nexport default function logoutall(req) {\n  const reqSecured = reqSecure(req, usersAllowedAttributes);\n  return new Promise(resolve => {\n    authentication(reqSecured).then(user => {\n      if (user) {\n        datumLoad({ redisKey: 'sessions' }).then(sessionData => {\n          for (let it = 0; it < sessionData.length; it += 1) {\n            const session = sessionData[it];\n            if (session.userId === user.id) {\n              session.userId = null;\n              session.userAuthenticatedTimestamp = null;\n              resolve(datumUpdate({ redisKey: 'sessions' }, { body: session }));\n              setContentLastUpdatedTimestamp();\n            }\n          }\n        });\n      }\n    });\n  });\n}\n"],"file":"logoutall.js"}