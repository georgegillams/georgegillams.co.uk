{"version":3,"sources":["../../../../server/api/actions/logout.js"],"names":["logout","req","reqSecured","usersAllowedAttributes","Promise","resolve","reject","redisKey","then","sessionData","cookies","session","existingValue","userId","userAuthenticatedTimestamp","body","success","error"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;AAEe,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AAClC,MAAMC,UAAU,GAAG,2BAAUD,GAAV,EAAeE,kCAAf,CAAnB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,0BAAU;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAV,EAAoCC,IAApC,CAAyC,UAAAC,WAAW,EAAI;AAAA,kBACnB,iBACjCA,WADiC,EAEjCP,UAAU,CAACQ,OAAX,CAAmBC,OAFc,EAGjC,YAHiC,CADmB;AAAA,UAC/BA,OAD+B,SAC9CC,aAD8C;;AAMtD,UAAID,OAAJ,EAAa;AACXA,QAAAA,OAAO,CAACE,MAAR,GAAiB,IAAjB;AACAF,QAAAA,OAAO,CAACG,0BAAR,GAAqC,IAArC;AACAT,QAAAA,OAAO,CAAC,wBAAY;AAAEE,UAAAA,QAAQ,EAAE;AAAZ,SAAZ,EAAsC;AAAEQ,UAAAA,IAAI,EAAEJ;AAAR,SAAtC,CAAD,CAAP;AACAN,QAAAA,OAAO,CAAC;AAAEW,UAAAA,OAAO,EAAE;AAAX,SAAD,CAAP;AACA;AACD,OAND,MAMO;AACLV,QAAAA,MAAM,CAAC;AACLW,UAAAA,KAAK,EACH;AAFG,SAAD,CAAN;AAID;AACF,KAlBD;AAmBD,GApBM,CAAP;AAqBD","sourcesContent":["import { datumLoad, datumUpdate } from '../actions/datum';\n\nimport usersAllowedAttributes from './users/usersAllowedAttributes';\n\nimport { find } from 'utils/find';\nimport setContentLastUpdatedTimestamp from 'utils/setContentLastUpdatedTimestamp';\nimport reqSecure from 'utils/reqSecure';\n\nexport default function logout(req) {\n  const reqSecured = reqSecure(req, usersAllowedAttributes);\n  return new Promise((resolve, reject) => {\n    datumLoad({ redisKey: 'sessions' }).then(sessionData => {\n      const { existingValue: session } = find(\n        sessionData,\n        reqSecured.cookies.session,\n        'sessionKey',\n      );\n      if (session) {\n        session.userId = null;\n        session.userAuthenticatedTimestamp = null;\n        resolve(datumUpdate({ redisKey: 'sessions' }, { body: session }));\n        resolve({ success: 'You are now logged out' });\n        setContentLastUpdatedTimestamp();\n      } else {\n        reject({\n          error:\n            'Invalid session. Try clearing cookies for this site and then re-authenticate',\n        });\n      }\n    });\n  });\n}\n"],"file":"logout.js"}