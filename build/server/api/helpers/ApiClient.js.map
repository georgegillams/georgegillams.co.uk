{"version":3,"sources":["../../../../server/api/helpers/ApiClient.js"],"names":["methods","formatUrl","path","adjustedPath","__SERVER__","config","apiHost","apiPort","ApiClient","req","forEach","method","params","data","Promise","resolve","reject","request","superagent","query","get","set","send","end","err","body"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;AAEA,IAAMA,OAAO,GAAG,CAAC,KAAD,EAAQ,MAAR,EAAgB,KAAhB,EAAuB,OAAvB,EAAgC,KAAhC,CAAhB;;AAEA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAMC,YAAY,GAAGD,IAAI,CAAC,CAAD,CAAJ,KAAY,GAAZ,cAAsBA,IAAtB,IAA+BA,IAApD;;AACA,MAAIE,UAAJ,EAAgB;AACd;AACA,4BAAiBC,mBAAOC,OAAxB,cAAmCD,mBAAOE,OAA1C,SAAoDJ,YAApD;AACD,GALsB,CAMvB;;;AACA,uBAAcA,YAAd;AACD;;IAEoBK,S;;;AACnB,qBAAYC,GAAZ,EAAiB;AAAA;;AAAA;AACfT,IAAAA,OAAO,CAACU,OAAR,CACE,UAAAC,MAAM;AAAA,aACH,KAAI,CAACA,MAAD,CAAJ,GAAe,UAACT,IAAD;AAAA,uFAA0B,EAA1B;AAAA,YAASU,MAAT,QAASA,MAAT;AAAA,YAAiBC,IAAjB,QAAiBA,IAAjB;;AAAA,eACd,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/B,cAAMC,OAAO,GAAGC,uBAAWP,MAAX,EAAmBV,SAAS,CAACC,IAAD,CAA5B,CAAhB;;AAEA,cAAIU,MAAJ,EAAY;AACVK,YAAAA,OAAO,CAACE,KAAR,CAAcP,MAAd;AACD;;AAED,cAAIR,UAAU,IAAIK,GAAG,CAACW,GAAJ,CAAQ,QAAR,CAAlB,EAAqC;AACnCH,YAAAA,OAAO,CAACI,GAAR,CAAY,QAAZ,EAAsBZ,GAAG,CAACW,GAAJ,CAAQ,QAAR,CAAtB;AACD;;AAED,cAAIP,IAAJ,EAAU;AACRI,YAAAA,OAAO,CAACK,IAAR,CAAaT,IAAb;AACD;;AAEDI,UAAAA,OAAO,CAACM,GAAR,CAAY,UAACC,GAAD;AAAA,4FAAiB,EAAjB;AAAA,gBAAQC,IAAR,SAAQA,IAAR;;AAAA,mBACVD,GAAG,GAAGR,MAAM,CAACS,IAAI,IAAID,GAAT,CAAT,GAAyBT,OAAO,CAACU,IAAD,CADzB;AAAA,WAAZ;AAGD,SAlBD,CADc;AAAA,OADZ;AAAA,KADR;AAuBD;AACD;;;;;;;;;;;;;;4BAUQ,CAAE","sourcesContent":["import superagent from 'superagent';\n\nimport config from '../config';\n\nconst methods = ['get', 'post', 'put', 'patch', 'del'];\n\nfunction formatUrl(path) {\n  const adjustedPath = path[0] !== '/' ? `/${path}` : path;\n  if (__SERVER__) {\n    // Prepend host and port of the API server to the path.\n    return `http://${config.apiHost}:${config.apiPort}${adjustedPath}`;\n  }\n  // Prepend `/api` to relative URL, to proxy to API server.\n  return `/api${adjustedPath}`;\n}\n\nexport default class ApiClient {\n  constructor(req) {\n    methods.forEach(\n      method =>\n        (this[method] = (path, { params, data } = {}) =>\n          new Promise((resolve, reject) => {\n            const request = superagent[method](formatUrl(path));\n\n            if (params) {\n              request.query(params);\n            }\n\n            if (__SERVER__ && req.get('cookie')) {\n              request.set('cookie', req.get('cookie'));\n            }\n\n            if (data) {\n              request.send(data);\n            }\n\n            request.end((err, { body } = {}) =>\n              err ? reject(body || err) : resolve(body),\n            );\n          })),\n    );\n  }\n  /*\n   * There's a V8 bug where, when using Babel, exporting classes with only\n   * constructors sometimes fails. Until it's patched, this is a solution to\n   * \"ApiClient is not defined\" from issue #14.\n   * https://github.com/erikras/react-redux-universal-hot-example/issues/14\n   *\n   * Relevant Babel bug (but they claim it's V8): https://phabricator.babeljs.io/T2455\n   *\n   * Remove it at your own risk.\n   */\n  empty() {}\n}\n"],"file":"ApiClient.js"}