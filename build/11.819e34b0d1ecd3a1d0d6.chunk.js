(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"./app/containers/AdminUsers/AdminUsersAPIEntity.js":function(e,t,n){"use strict";var s=n("./node_modules/@babel/runtime/helpers/interopRequireWildcard.js"),r=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./node_modules/@babel/runtime/helpers/jsx.js")),o=r(n("./node_modules/@babel/runtime/helpers/slicedToArray.js")),i=r(n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js")),d=s(n("./node_modules/react/index.js")),u=(r(n("./node_modules/prop-types/index.js")),n("./node_modules/gg-components/Auth/index.js")),l=n("./node_modules/gg-components/Button/index.js"),c=n("./node_modules/gg-components/Cards/index.js"),p=r(n("./app/containers/AdminUserEdit/Loadable.js")),f=(0,a.default)("br",{}),m=(0,a.default)("br",{}),g=function(e){var t=e.entity,n=e.onUserUpdateSuccess,s=e.children,r=(0,i.default)(e,["entity","onUserUpdateSuccess","children"]),g=(0,d.useState)(!1),v=(0,o.default)(g,2),b=v[0],_=v[1],j=null;return"COMPLETE"===t.overallRegistrationStatus&&"COMPLETE"!==t.registrationStatus.photoRelease?j="yellow":"COMPLETE"===t.overallRegistrationStatus?j="#b4fcb4":"INCOMPLETE"===t.overallRegistrationStatus&&(j="#FFB964"),d.default.createElement(c.Card,r,(0,a.default)(u.APIEntity,{style:{backgroundColor:j},entity:t}),b&&t&&(0,a.default)(p.default,{style:{width:"100%"},id:t.id,testProp:"testProp",onUserUpdateSuccess:function(){n(),setTimeout((function(){_(!1)}),500)}}),f,m,(0,a.default)(l.Button,{large:!0,onClick:function(){_(!b)}},void 0,b?"Cancel edit":"Edit user"),s&&s)};t.default=g,e.exports=t.default},"./app/containers/AdminUsers/Container.js":function(e,t,n){"use strict";var s=n("./node_modules/@babel/runtime/helpers/interopRequireWildcard.js"),r=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./node_modules/@babel/runtime/helpers/extends.js")),o=r(n("./node_modules/@babel/runtime/helpers/jsx.js")),i=r(n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js")),d=r(n("./node_modules/@babel/runtime/helpers/classCallCheck.js")),u=r(n("./node_modules/@babel/runtime/helpers/createClass.js")),l=r(n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=r(n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=r(n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),f=r(n("./node_modules/@babel/runtime/helpers/inherits.js")),m=r(n("./node_modules/@babel/runtime/helpers/defineProperty.js")),g=s(n("./node_modules/react/index.js")),v=(r(n("./node_modules/prop-types/index.js")),n("./node_modules/react-helmet/lib/Helmet.js")),b=n("./node_modules/bpk-react-utils/index.js"),_=r(n("./app/containers/AdminUsers/AdminUsersAPIEntity.js")),j=r(n("./app/containers/AdminUsers/Skeleton.js")),h=r(n("./app/containers/AdminUsers/generateCsv.js")),y=r(n("./helpers/HelperFunctions.js")),k=(n("./node_modules/gg-components/LoadingIndicator/index.js"),n("./node_modules/gg-components/Cards/index.js"),n("./node_modules/gg-components/Button/index.js")),A=n("./node_modules/gg-components/Typography/index.js"),O=(n("./node_modules/gg-components/Code/index.js"),r(n("./app/components/Ticket/index.js")),n("./node_modules/gg-components/Auth/index.js")),T=(n("./app/components/Forms/index.js"),n("./app/components/Sessions/index.js")),x=n("./helpers/clientOperations.js"),C=r(n("./app/containers/pages.scss")),E=(0,b.cssModules)(C.default),U=(0,o.default)("span",{},void 0,"Users: "),R=(0,o.default)("br",{}),S=(0,o.default)("br",{}),D=(0,o.default)("br",{}),w=(0,o.default)("br",{}),P=(0,o.default)("br",{}),M=(0,o.default)("br",{}),I=(0,o.default)("br",{}),N=(0,o.default)("br",{}),L=(0,o.default)("br",{}),B=(0,o.default)("br",{}),F=(0,o.default)("br",{}),q=(0,o.default)("br",{}),Y=(0,o.default)(v.Helmet,{title:"Admin - users"}),W=function(e){function t(e){var n;return(0,d.default)(this,t),n=(0,l.default)(this,(0,c.default)(t).call(this,e)),(0,m.default)((0,p.default)(n),"componentDidMount",(function(){n.props.loadUsers()})),(0,m.default)((0,p.default)(n),"expandAll",(function(){for(var e=document.getElementsByTagName("DIV"),t=0;t<e.length;t+=1){var n=e[t];y.default.includes(n.textContent,"▶️ ")&&n.click()}})),n.state={},n}return(0,f.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=this.props,t=e.setLoginRedirect,n=e.user,s=e.userLoading,r=e.cookiesAllowed,d=e.onCookiesAccepted,u=e.className,l=e.loadUsers,c=e.users,p=e.loadingUsers,f=e.loadUserSuccess,m=e.loadUserError,v=e.requestMagicLinkForUser,b=(0,i.default)(e,["setLoginRedirect","user","userLoading","cookiesAllowed","onCookiesAccepted","className","loadUsers","users","loadingUsers","loadUserSuccess","loadUserError","requestMagicLinkForUser"]),y=[];u&&y.push(u);var C=g.default.createElement("div",(0,a.default)({className:y.join(" ")},b),(0,o.default)(O.AdminOnly,{user:n,setLoginRedirect:function(){return t("admin/users")}},void 0,(0,o.default)(A.Section,{name:"Admin - users"},void 0,U,c&&c.length&&(0,o.default)("span",{},void 0,c.length),R,S,(0,o.default)(k.Button,{onClick:function(){return l()},large:!0},void 0,"Reload users"),D,w,c&&c.length&&(0,o.default)(g.Fragment,{},void 0,(0,o.default)(k.Button,{onClick:function(){return e=c,t=(0,h.default)(e),void(0,x.downloadStringAsCsv)("user_data.csv",t);var e,t},large:!0},void 0,"Download user data"),P,M,(0,o.default)(k.Button,{onClick:this.expandAll,large:!0},void 0,"Expand all entities")),I,N,c&&c.map&&c.map((function(e){return(0,o.default)(_.default,{name:"more",entityType:"User",entity:e,onUserUpdateSuccess:function(){l()},className:E("pages__component")},void 0,L,B,(0,o.default)(k.Button,{large:!0,href:"/admin/users/".concat(e.id)},void 0,"Edit user on dedicated page"),F,q,(0,o.default)(k.Button,{destructive:!0,large:!0,onClick:function(){return v(e)}},void 0,"Login as user"))})))));return(0,o.default)(g.Fragment,{},void 0,Y,(0,o.default)(T.CookiesOnly,{cookiesAccepted:r,onAccept:d}),(0,o.default)(O.LoadingCover,{loadingSkeleton:j.default,loading:!r||s||!c},void 0,C),(0,o.default)(O.DebugObject,{debugTitle:"Admin users",debugObject:{setLoginRedirect:t,user:n,userLoading:s,cookiesAllowed:r,onCookiesAccepted:d,className:u,loadUsers:l,users:c,loadingUsers:p,loadUserSuccess:f,loadUserError:m,requestMagicLinkForUser:v}}))}}]),t}(g.default.Component);t.default=W,e.exports=t.default},"./app/containers/AdminUsers/generateCsv.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n("./helpers/ticketing.js"),r=function(e,t){return e.registrationStatus&&e.registrationStatus[t]||""},a=function(e,t){return e.userDetails&&e.userDetails[t]||""},o=function(e,t){return e.ticketReservation&&e.ticketReservation[t]||""},i=function(e){var t="userId,forename,surname,email,returningDelegate,university,degree,yearOfStudy,dietaryRequirements,alergies,otherRequirements,photoReleaseConsented,ticketReservation,outstandingBalance,ticketValid, hasArrivedAtConferenceDay1, hasArrivedAtConferenceDay2";return e.forEach((function(e){var n=e.id,i=a(e,"name"),d=a(e,"surname"),u=e.email||"",l=a(e,"university"),c=a(e,"returningDelegate")?"✓":"✘",p=a(e,"degreeCourse"),f=a(e,"yearOfStudy"),m=a(e,"dietaryRequirements"),g=a(e,"alergies"),v=a(e,"otherRequirements"),b=a(e,"photoReleaseConsented")?"✓":"✘",_=o(e,"outstandingBalance"),j=e.ticketReservation&&(0,s.ticketReservationIsValid)(e.ticketReservation)&&_<=0,h=j?"✓":"",y=j?o(e,"ticketType"):"✘",k=r(e,"hasArrivedAtConferenceDay1")?"✓":"✘",A=r(e,"hasArrivedAtConferenceDay2")?"✓":"✘";j&&(t+="\n".concat(n,",").concat(i,",").concat(d,",").concat(u,",").concat(c,",").concat(l,",").concat(p,",").concat(f,",").concat(m,",").concat(g,",").concat(v,",").concat(b,",").concat(y,",").concat(_,",").concat(h,",").concat(k,",").concat(A))})),t};t.default=i,e.exports=t.default},"./app/containers/AdminUsers/index.js":function(e,t,n){"use strict";var s=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),r=s(n("./node_modules/@babel/runtime/helpers/defineProperty.js")),a=s(n("./app/containers/App/selectors.js")),o=n("./helpers/redux/index.js"),i=s(n("./app/containers/AdminUsers/actionMeta.js")),d=n("./app/containers/AdminUsers/redux-definitions.js"),u=s(n("./app/containers/AdminUsers/saga.js")),l=s(n("./app/containers/AdminUsers/Container.js"));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.exports=(0,o.composeContainer)(l.default,i.default.key,p({},d.selectors,{},a.default),p({},d.actions),d.reducer,u.default)},"./app/containers/AdminUsers/saga.js":function(e,t,n){"use strict";var s=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.doRequestMagicLink=A,t.doLoadUsers=O,t.default=T;var r=s(n("./node_modules/@babel/runtime/regenerator/index.js")),a=n("./app/containers/AdminUsers/redux-definitions.js"),o=n("./node_modules/redux-saga/dist/redux-saga-effects-npm-proxy.cjs.js"),i=n("./app/containers/RequestStatusWrapper/actions.js"),d=n("./helpers/constants.js"),u=(n("./helpers/ticketing.js"),n("./helpers/objects.js")),l=s(n("./app/utils/request.js")),c=r.default.mark(A),p=r.default.mark(O),f=r.default.mark(T),m=a.constants.LOAD_USERS,g=a.constants.REQUEST_MAGIC_LINK_FOR_USER,v=a.actions.loadUsersRegisterSuccess,b=a.actions.loadUsersRegisterError,_=a.selectors.makeSelectMagicLinkUser,j={type:"success",message:"Users loaded!"},h={type:"error",message:"Could not load users."},y={type:"success",message:"Magic link for user sent!"},k={type:"error",message:"Could not generate magic link."};function A(){var e,t;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,o.select)(_());case 2:return e=n.sent,t="".concat(d.API_ENDPOINT,"/getmagiclink"),n.prev=4,n.next=7,(0,o.call)(l.default,t,{method:"POST",body:JSON.stringify({email:e.email,divertToAdmin:!0}),headers:{"Content-Type":"application/json"}});case 7:if(!n.sent.error){n.next=13;break}return n.next=11,(0,o.put)((0,i.pushMessage)(k));case 11:n.next=15;break;case 13:return n.next=15,(0,o.put)((0,i.pushMessage)(y));case 15:n.next=21;break;case 17:return n.prev=17,n.t0=n.catch(4),n.next=21,(0,o.put)((0,i.pushMessage)(d.COMMUNICATION_ERROR_MESSAGE));case 21:case"end":return n.stop()}}),c,null,[[4,17]])}function O(){var e,t,n,s,a;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e="".concat(d.API_ENDPOINT,"/users/load"),t="".concat(d.API_ENDPOINT,"/userDetails/loadAll"),r.prev=2,r.next=5,(0,o.call)(l.default,e,{method:"GET"});case 5:return n=r.sent,r.next=8,(0,o.call)(l.default,t,{method:"GET"});case 8:if(s=r.sent,!n.error){r.next=16;break}return r.next=12,(0,o.put)(b(n));case 12:return r.next=14,(0,o.put)((0,i.pushMessage)(h));case 14:r.next=28;break;case 16:if(!s.error){r.next=23;break}return r.next=19,(0,o.put)(b(s));case 19:return r.next=21,(0,o.put)((0,i.pushMessage)(h));case 21:r.next=28;break;case 23:return a=(0,u.associate)(n,s,"id","authorId","userDetails"),r.next=26,(0,o.put)(v(a));case 26:return r.next=28,(0,o.put)((0,i.pushMessage)(j));case 28:r.next=36;break;case 30:return r.prev=30,r.t0=r.catch(2),r.next=34,(0,o.put)(b(r.t0));case 34:return r.next=36,(0,o.put)((0,i.pushMessage)(d.COMMUNICATION_ERROR_MESSAGE));case 36:case"end":return r.stop()}}),p,null,[[2,30]])}function T(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeLatest)(m,O);case 2:return e.next=4,(0,o.takeLatest)(g,A);case 4:case"end":return e.stop()}}),f)}},"./helpers/clientOperations.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.downloadStringAsCsv=t.downloadFile=void 0;var s=function(e){var t=document.createElement("a");return t.setAttribute("href",window.URL.createObjectURL(e)),t.setAttribute("download",e.name),t.style.display="none",document.body.appendChild(t),t.click(),Promise.resolve(e.name)};t.downloadFile=s;var r=function(e,t){s(new File([t],e,{type:"text/csv",lastModified:new Date}))};t.downloadStringAsCsv=r;var a={downloadFile:s,downloadStringAsCsv:r};t.default=a},"./helpers/ticketing.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.beautifyTicketType=t.validateType=t.getPriceForTicketType=t.calculateOutstandingBalance=t.ticketCanBeReserved=t.ticketReservationIsValid=t.reserveTicket=void 0;var s=n("./helpers/constants.js"),r={EB_ONE_DAY:s.TICKET_COST_EB_ONE_DAY,EB_TWO_DAY:s.TICKET_COST_EB_TWO_DAY,R_ONE_DAY:s.TICKET_COST_R_ONE_DAY,R_TWO_DAY:s.TICKET_COST_R_TWO_DAY},a={EB_ONE_DAY:"Saturday only early bird ticket",EB_TWO_DAY:"Full weekend early bird ticket",R_ONE_DAY:"Saturday only ticket",R_TWO_DAY:"Full weekend ticket"},o=function(e){return r[e]||0};t.getPriceForTicketType=o;var i=function(e){return!e.reservedUntil||new Date(e.reservedUntil).getTime()<(new Date).getTime()};t.ticketCanBeReserved=i;var d=function(e){return!!e&&!i(e)};t.ticketReservationIsValid=d;var u=function(e,t,n){var r=JSON.parse(JSON.stringify(e));return r.reservedTo=t.id,r.reservedUntil=(new Date).getTime()+36e5*s.TICKET_RESERVATION_LENGTH,n&&n.reservedUntil&&(r.reservedUntil=Math.max(n.reservedUntil,r.reservedUntil)),r};t.reserveTicket=u;var l=function(e,t){if(!e)return 0;var n=o(e.ticketType);if(!t)return n;for(var s=n,r=0;r<t.length;r+=1)s-=t[r].amount;return s=Math.max(0,s)};t.calculateOutstandingBalance=l;var c=function(e){return!!r[e]};t.validateType=c;var p=function(e){return a[e]||e};t.beautifyTicketType=p;var f={reserveTicket:u,ticketReservationIsValid:d,ticketCanBeReserved:i,calculateOutstandingBalance:l,getPriceForTicketType:o,validateType:c,beautifyTicketType:p};t.default=f}}]);